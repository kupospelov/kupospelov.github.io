<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Sway gets layout-independent bindsym command - Konstantin Pospelov</title><link rel=stylesheet href=https://kupospelov.com/style.min.5d298a7a6c267254772ab46f87359bb2db054b8a637a056523c00efed12e790b.css type=text/css media=all><link rel=stylesheet href=https://kupospelov.com/syntax-light.min.458f0b209e7b32727c308bd91b27f7aefb4ae4b76b3f2032c2f83b3fd43f7352.css type=text/css media="screen and (prefers-color-scheme: light)"><link rel=stylesheet href=https://kupospelov.com/syntax-dark.min.d8ad658c02e1ff4f154ed92513da0a2763959be0a25adfd74e26f37b64eee8fd.css type=text/css media="screen and (prefers-color-scheme: dark)"><link rel=icon type=image/jpg href=/img/me.jpg></head><body><nav class=menu><a class=menu-item href=/>about</a>
<a class="menu-item current" href=/blog/>blog</a><hr></nav><main><article><time pubdate=pubdate>Jun 02, 2019</time><h1>Sway gets layout-independent bindsym command</h1><p>The default behavior of the <code>bindsym</code> command in Sway is a major pain point for users with several configured keyboard layouts. The command literally binds actions to keysyms, which means that your shortcuts constantly change their position or may not work at all.</p><p>What makes it look even more weird is that in i3 <code>bindsym</code> <em>does</em> work consistently in any layout, because i3 simply translates the specified keysyms into keycodes. You can even specify which layout should be used for the translation using <code>Group[1-4]</code>.</p><p>The topic of input processing is far more complex than I could imagine, mostly because different people have <em>very</em> different opinions about how it should be implemented. The very idea to change the meaning of the <code>bindsym</code> command triggered a lot of back-and-forth discussion with quite a few people involved.</p><p>The process took some time, but in the end we finally got a solution that should work for everyone. With the new <code>--to-code</code> flag, the behavior of Sway&rsquo;s <code>bindsym</code> becomes roughly equivalent to that of i3. This is not as tedious as you might think, because you can specify the flag only once per block of bindings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>bindsym --to-code <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$mod</span>+Return <span class=nb>exec</span> <span class=nv>$term</span>
</span></span><span class=line><span class=cl>    <span class=nv>$mod</span>+Shift+c reload
</span></span><span class=line><span class=cl>    <span class=c1># etc</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>A few points regarding the current implementation:</p><ul><li>The translation only uses the first configured layout. A change in the input configuration can trigger re-translation of the configured bindings.</li><li>In case the translation fails, the binding will work as an ordinary <code>bindsym</code>, and a warning will be logged. We cannot fail the command in this case, because <code>input</code> and <code>bindsym</code> commands can be in any order (and cannot be sorted, in case of IPC), so the relevant input configuration may not be available yet.</li><li>In case a keysym cannot be resolved into a single keycode, the translation will fail. This should not be a frequent use-case, so the complexity it introduces is not worth it at this point.</li></ul><p>The feature will appear in Sway 1.1, which is going to be released soon. You can also get an RC build and try it out now.</p></article></main><footer><hr><p>The content is licensed under <a rel=license href=http://creativecommons.org/licenses/by/4.0/>CC BY 4.0</a>.</p><br></footer></body></html>