<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Bootstrapping rootless containers with Ansible - Konstantin Pospelov</title><link rel=stylesheet href=https://kupospelov.com/style.min.5d298a7a6c267254772ab46f87359bb2db054b8a637a056523c00efed12e790b.css type=text/css media=all><link rel=stylesheet href=https://kupospelov.com/syntax-light.min.458f0b209e7b32727c308bd91b27f7aefb4ae4b76b3f2032c2f83b3fd43f7352.css type=text/css media="screen and (prefers-color-scheme: light)"><link rel=stylesheet href=https://kupospelov.com/syntax-dark.min.d8ad658c02e1ff4f154ed92513da0a2763959be0a25adfd74e26f37b64eee8fd.css type=text/css media="screen and (prefers-color-scheme: dark)"><link rel=icon type=image/jpg href=/img/me.jpg></head><body><nav class=menu><a class=menu-item href=/>about</a>
<a class="menu-item current" href=/blog/>blog</a><hr></nav><main><article><time pubdate=pubdate>Jan 17, 2026</time><h1>Bootstrapping rootless containers with Ansible</h1><p>Some deployments can be easily automated with SSH and shell scripts, but once a deployment reaches a certain (not-so-big) size, one may start searching for easier to manage alternatives. In this post, I will summarize what I ended up using so far and describe an automated way to bring up a machine with rootless Podman containers using the official <a href=https://hub.docker.com/_/nginx>nginx</a> image as an example.</p><h2 id=podman>Podman</h2><p>First, let&rsquo;s cover the container configuration, and then move to the configuration of the managed node. For simplicity, this part assumes that you run a Linux system and have Podman installed.</p><h3 id=why-podman>Why Podman?</h3><p>I prefer Podman for a couple of reasons:</p><ol><li>Daemonless and rootless approach that reduces the attack surface.</li><li>Systemd integration that simplifies the whole setup. You can basically run your containers as (almost) regular systemd services.</li></ol><p>I can also recommend the book <a href=https://developers.redhat.com/e-books/podman-action>Podman in Action</a> that covers Podman in more detail.</p><h3 id=quadlets>Quadlets</h3><p>Nowadays systemd supports <a href=https://www.redhat.com/en/blog/quadlet-podman>quadlets</a> that make running containers somewhat easier compared to the more manual <a href=https://docs.podman.io/en/latest/markdown/podman-generate-systemd.1.html>podman systemd generate</a> approach. The idea is that you can describe Podman flags in the <code>[Container]</code> section of the quadlet, and systemd will generate a service unit file for it. You can also enable automatic updates using <code>AutoUpdate=registry</code> and systemd will be updating the container image for you. Nice!</p><p>We can create <code>~/.config/containers/systemd/nginx.container</code> with the following contents:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-systemd data-lang=systemd><span class=line><span class=cl><span class=k>[Container]</span>
</span></span><span class=line><span class=cl><span class=na>Image</span><span class=o>=</span><span class=s>docker.io/library/nginx:latest</span>
</span></span><span class=line><span class=cl><span class=na>AutoUpdate</span><span class=o>=</span><span class=s>registry</span>
</span></span><span class=line><span class=cl><span class=na>PublishPort</span><span class=o>=</span><span class=s>8080:80</span>
</span></span><span class=line><span class=cl><span class=na>Volume</span><span class=o>=</span><span class=s>%h/nginx/content:/var/www/html:Z,ro</span>
</span></span><span class=line><span class=cl><span class=na>Volume</span><span class=o>=</span><span class=s>%h/nginx/nginx.conf:/etc/nginx/nginx.conf:Z,ro</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>always</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>default.target</span>
</span></span></code></pre></div><p>This container needs a config. Let&rsquo;s create the simplest <code>~/nginx/nginx.conf</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>worker_processes</span> <span class=s>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>events</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kn>worker_connections</span> <span class=mi>64</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>http</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kn>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kn>server_name</span> <span class=s>localhost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=kn>root</span> <span class=s>/var/www/html</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=kn>index</span> <span class=s>index.html</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>We also need some content to serve, so let&rsquo;s put the following <code>index.html</code> in <code>~/nginx/content/</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Hello from Podman!<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>Finally, before our user can run the container, we need to allocate user and group id ranges. You can read more in the rootless Podman <a href=https://github.com/containers/podman/blob/main/docs/tutorials/rootless_tutorial.md>tutorial</a>, but to keep this post short you can just run this command to allocate the <code>100000-165535</code> id ranges for your user in <code>/etc/subuid</code> and <code>/etc/subgid</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>usermod --add-subuids 100000-165535 --add-subgids 100000-165535 <span class=nv>$USER</span>
</span></span></code></pre></div><p>&mldr;and that&rsquo;s almost it! To test the container locally, run these commands:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>systemctl --user daemon-reload
</span></span><span class=line><span class=cl>systemctl --user start nginx
</span></span></code></pre></div><p>The first command generates a service file based on the quadlet, and the second one starts the new service. If the service for some reason fails to start, you can use <code>journalctl -xe</code> to see the most recent failures in the journal.</p><p>You should now see the index page if you open <a href=http://localhost:8080>http://localhost:8080</a>.</p><h2 id=ansible>Ansible</h2><p>Now that we have a working local setup, we can replicate it on a managed node. This section assumes that the host runs Debian 13, but except for the <code>apt</code> module the configuration should be mostly the same for any other distribution.</p><h2 id=why-ansible>Why Ansible?</h2><p><a href=https://docs.ansible.com/>Ansible</a> is by no means a new tool, but it&rsquo;s still maintained and I find it intuitive to use for simple use cases like this. My first attempt at automating setting up a new VM involved a few shell scripts, and when I replaced all of them with a single Ansible playbook, the setup has become much simpler.</p><p>Another seemingly good option is <a href=https://coreos.github.io/butane/getting-started/>Butane</a>. I like the idea of running a minimal Fedora CoreOS, but unlike Debian not every VPS provider has a default image for it, and the instructions to install it manually look a bit tedious. Maybe I&rsquo;ll try it some other time and write a post about how to achieve the same with CoreOS and Butane :)</p><h2 id=playbook>Playbook</h2><p>Ansible allows you to describe the configuration as a YAML <a href=https://docs.ansible.com/projects/ansible/latest/playbook_guide/playbooks_intro.html>playbook</a>. Playbooks use <a href=https://docs.ansible.com/projects/ansible/2.9/modules/list_of_all_modules.html>modules</a> to describe the end state, e.g. a copied file or installed package.</p><p>Playbooks can be run using <code>ansible-playbook &lt;playbook.yaml> -u &lt;user> -i &lt;inventory></code>, where <code>user</code> is the user to use and <code>inventory</code> can either be an <a href=https://docs.ansible.com/projects/ansible/devel/inventory_guide/intro_inventory.html>inventory file</a> or a comma-separated list of hosts, e.g. <code>1.2.3.4,</code> (note a comma in the end!).</p><p><a href=example.yaml>Here</a> is the complete example. The rest of the post explains it section by section. I&rsquo;m not going into too much detail though, refer to the official <a href=https://devdocs.io/ansible/collections/ansible/builtin/index>documentation</a> to clarify specific module options.</p><p>Let&rsquo;s start with defining a playbook that will install the required Debian packages:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>vars</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nginx_user</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nginx_home</span><span class=p>:</span><span class=w> </span><span class=l>/home/nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install packages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.apt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pkg</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>podman</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>systemd-container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>present</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>update_cache</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>cache_valid_time</span><span class=p>:</span><span class=w> </span><span class=m>3600</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=l>packages</span><span class=w>
</span></span></span></code></pre></div><p>Now, let&rsquo;s create a new user. Here we also allocate the id ranges and enable lingering to make sure the user services start after a reboot:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Create user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.user</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ nginx_user }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>present</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>create_home</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>home</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ nginx_home }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>/sbin/nologin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>system</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=l>user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Allocate user ids</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.lineinfile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/etc/subuid</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>line</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ nginx_user }}:100000:65536&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>create</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=l>user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Allocate group ids</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.lineinfile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/etc/subgid</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>line</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ nginx_user }}:100000:65536&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>create</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=l>user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Enable lingering</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>cmd</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;loginctl enable-linger {{ nginx_user }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>changed_when</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=l>user</span><span class=w>
</span></span></span></code></pre></div><p>Once we have the user configured, we can copy all the configuration files from the control node to the remote user&rsquo;s home directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Create directories</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.file</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ item }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>owner</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ nginx_user }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ nginx_user }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;0755&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>loop</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s2>&#34;{{ nginx_home }}/.config/containers/systemd&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s2>&#34;{{ nginx_home }}/nginx/content&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=l>config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Copy files</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.copy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>src</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ item.src }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ item.dest }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>owner</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ nginx_user }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ nginx_user }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;0644&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>loop</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>src</span><span class=p>:</span><span class=w> </span><span class=l>~/nginx/nginx.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ nginx_home }}/nginx/nginx.conf&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>src</span><span class=p>:</span><span class=w> </span><span class=l>~/nginx/content/index.html</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ nginx_home }}/nginx/content/index.html&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>src</span><span class=p>:</span><span class=w> </span><span class=l>~/.config/containers/systemd/nginx.container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ nginx_home }}/.config/containers/systemd/nginx.container&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=l>config</span><span class=w>
</span></span></span></code></pre></div><p>Finally, we can reload daemons and start the service:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Reload daemons</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>cmd</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;systemctl --machine={{ nginx_user }}@ --user daemon-reload&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>changed_when</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=l>service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Start service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>cmd</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;systemctl --machine={{ nginx_user }}@ --user start nginx&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>changed_when</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=l>service</span><span class=w>
</span></span></span></code></pre></div><p>Note that Ansible has a <a href=https://docs.ansible.com/projects/ansible-core/2.13/collections/ansible/builtin/systemd_module.html>systemd module</a>. However, I found it very cumbersome to use for the user scope. It requires setting the <code>XDG_RUNTIME_DIR</code> environment variable that contains a user id. It&rsquo;s possible to query it (e.g. using <code>ansible.builtin.getent</code>), but I think it&rsquo;s way easier just to call <code>systemctl --machine=nginx@</code>.</p><p>If your firewall does not block port <code>8080</code>, you should be able to see the page served by your server.</p><h2 id=summary>Summary</h2><p>That&rsquo;s finally it! You should now have a working rootless setup that supports automatic updates and can be easily re-created on a new Debian machine.</p></article></main><footer><hr><p>The content is licensed under <a rel=license href=http://creativecommons.org/licenses/by/4.0/>CC BY 4.0</a>.</p><br></footer></body></html>